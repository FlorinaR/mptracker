{% extends 'layout.html' %}

{% set TYPE_MAP = {
    'question': "întrebare",
    'interpelation': "interpelare",
    'proposal': "propunere legislativă",
    'speech': "luare de cuvânt",
  } %}


{% block title %}{{ super() }} – {{ name }}{% endblock %}


{%- macro ordinal(n) %}
  {%- if n == 1 %}primul
  {%- elif n == 2 %}al doilea
  {%- elif n == 3 %}al treilea
  {%- elif n == 4 %}al patrulea
  {%- else %}al {{ n }}-lea
  {%- endif %}
{%- endmacro %}


{% block content %}
  <h1>{{ name }}</h1>
  <!-- person_id='{{ person_id }}' -->
  <!-- mandate_id='{{ mandate_id }}' -->

  <div class="row">
    <div class="col-sm-8">
      <div class="activitychart"></div>
      <div class="membershipchart"></div>

      <ul class="list-unstyled">
        {% if college %}
          <li>
            Deputat de
            {%- if college.county_code %}
              {% set url = url_for(
                  '.person_county',
                  county_code=college.county_code,
                ) %}
              <a href="{{ url }}">{{ college.county_name }}</a>
            {%- else %}
              {{ college.county_name }}
            {%- endif %},
            colegiul D{{ college.number }}

            {%- if college.election_votes_fraction %}
              ({{ college.election_votes_fraction|percent }} din voturi)
            {%- endif %},
            {{ ordinal(mandate_count) }} mandat
          </li>
        {% else %}
          <li>Ales la nivel național</li>
        {% endif %}

        {% for position in position_list %}
          <li>
            {{ position.title|maybe_url(position.url) }}
            ({{ position.start_date|datefmt }} &ndash;
             {{ position.end_date|datefmt or 'prezent' }})
          </li>
        {% endfor %}

        {% for membership in committee_list %}
          <li>
            {% if membership.role %}{{ membership.role }}, {% endif %}
            {{ membership.committee_name|maybe_url(membership.committee_url) }}
            ({{ membership.start_date|datefmt }} &ndash;
             {{ membership.end_date|datefmt or 'prezent' }})
          </li>
        {% endfor %}

        {% for membership in group_history %}
          <li>
            {{ membership.group_short_name|link_for(
                '.party_detail',
                party_short_name=membership.group_short_name,
              ) }}
            ({{ membership.start_date|datefmt }} &ndash;
             {{ membership.end_date|datefmt or 'prezent' }})
            {% if membership.role %}({{ membership.role }}){% endif %}
          </li>
        {% endfor %}
      </ul>

      <dl class="dl-horizontal">
        {%- if contact.website_url %}
          <dt>site</dt>
          <dd>{{ contact.website_url|urlize }}</dd>
        {%- endif %}

        {%- if contact.blog_url %}
          <dt>blog</dt>
          <dd>{{ contact.blog_url|urlize }}</dd>
        {%- endif %}

        {%- if contact.email_value %}
          <dt>email</dt>
          <dd>{{ contact.email_value|urlize }}</dd>
        {%- endif %}

        {%- if contact.facebook_url %}
          <dt>facebook</dt>
          <dd>{{ contact.facebook_url|urlize }}</dd>
        {%- endif %}

        {%- if contact.twitter_url %}
          <dt>twitter</dt>
          <dd>{{ contact.twitter_url|urlize }}</dd>
        {%- endif %}

        {%- if contact.phone %}
          <dt>phone</dt>
          <dd>{{ contact.phone }}</dd>
        {%- endif %}

        {%- if contact.address %}
          <dt>address</dt>
          <dd>{{ contact.address }}</dd>
        {%- endif %}
      </dl>

      <div>
        <h3>Activitate recentă</h3>

        <ul class="list-unstyled">
          {% for item in recent_activity %}
            <li>
              <strong>
                {{ item['date']|datefmt }},
                {{ TYPE_MAP.get(item['type']) }}
              </strong>:

              {{ item['text']|maybe_url(item['url']) }}
            </li>
          {% endfor %}
        </ul>
      </div>

      {%- if romania_curata_text %}
        <h3>
          <a href="http://verificaintegritatea.romaniacurata.ro/">
            Contracte cu statul și probleme de integritate - România Curată
          </a>
        </h3>

        <p class="romania-curata-text">{{ romania_curata_text }}</p>
      {%- endif %}

      {%- if assets %}
        <h3>Declarația de avere</h3>
        <p>
          avere: €{{ assets['net_worth_eur'] }};
          terenuri:
            {{ "%.2f"|format(assets['land_agri_area'] / MP_HA) }} ha agricol,
            {{ assets['land_city_area'] }} m<sup>2</sup> intravilan;
          imobile: {{ assets['realty_count'] }};
          vehicule: {{ assets['vehicle_count'] }};
          venit anul trecut: €{{ assets['year_income_eur'] }};
          {{ "detalii"|link_for('.person_assets', person_slug=person_slug) }}
        </p>
      {%- endif %}

      <h3>Voturi controversate</h3>

      <ul>
      {%- for controversy in controversy_list %}
        <li>
          <strong>{{ controversy.date|datefmt }}</strong> –
          {{ controversy.title }}:
          <strong>{{ VOTE_LABEL[controversy.choice] }}</strong>
        </li>
      {%- endfor %}
      </ul>
    </div>

    <div class="col-sm-4">
      <div>
        {%- if picture_url %}
          <div class="person-image-box">
            <img src="{{ picture_url }}">
          </div>
        {%- endif %}

        <h4>Statistici</h4>

        {%- from '_person_bits.html' import person_stats %}
        {{ person_stats(person_slug, stats) }}

        <p>
          {%- set url = url_for('.person_compare_index', person_slug=person_slug) %}
          <a href="{{ url }}">Comparații cu alți deputați</a>
        </p>
      </div>

      <h4>Domenii de politici publice</h4>

      <ul>
        {%- for policy in policy_domains %}
          <li>
            {{ policy.name|link_for('.policy_detail', policy_slug=policy.slug) }}
            ({{ policy.interest|percent }})
          </li>
        {%- endfor %}
      </ul>

      <p style="height: 300px">
        {{ top_words }}
      </p>
    </div>
  </div>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static',
    filename='lib/d3-3.3.13/d3.v3.js') }}"></script>
<script src="{{ url_for('static',
    filename='lib/d3-tip-70b1cf3/d3-tip.js') }}"></script>
<script src="{{ url_for('static', filename='activitychart.js') }}"></script>
<script src="{{ url_for('static', filename='membershipchart.js') }}"></script>
<script>
  $(document).ready(function() {
    var activitychart_data = {{ activitychart_data|tojson|safe }};
    app.render_activitychart($('.activitychart'), activitychart_data);

    var group_history = {{ group_history|tojson|safe }};
    app.render_membershipchart($('.membershipchart'), group_history);
  });
</script>
{% endblock %}
