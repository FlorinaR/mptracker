{% extends 'layout.html' %}


{% block content %}
  <h1>Open Parlament</h1>

  <div class="row">
    <div class="col-sm-8">
      {{ text('editorial', fold=True) }}

      <p>
        <a href="{{ url_for('.text_page', name='editorial') }}">
          citește mai mult
        </a>
      </p>

      {{ text('local', fold=True) }}

      <p>
        <a href="{{ url_for('.text_page', name='local') }}">
          citește mai mult
        </a>
      </p>

      {{ text('voting_controversy', fold=True) }}

      <p>
        <a href="{{ url_for('.text_page', name='voting_controversy') }}">
          citește mai mult
        </a>
      </p>

      <h2>Contribuie</h2>

      <p>
        <a href="{{ url_for('.text_page', name='donations') }}">
          citește mai mult
        </a>
      </p>
    </div>

    <div class="col-sm-4">
      <p>
        {% set url = url_for('.policy_tacit') %}
        <a href="{{ url }}">legi adoptate tacit ({{ tacit_approvals_count }})</a>
      </p>

      <p>
        {% set url = url_for('.policy_controversy') %}
        <a href="{{ url }}">legi controversate ({{ controversy_count }})</a>
      </p>

      <p>
        <a href="{{ url_for('.person_migrations') }}">migrări recente</a>
      </p>

      <h3>Propuneri legislative</h3>

      <ul class="list-unstyled">
        {% for item in recent_proposals %}
          {% set url = url_for(
              '.policy_proposal',
              proposal_id=item['proposal_id'],
            ) %}
          <li>
            <strong>{{ item['date']|datefmt }}:</strong>

            <a href="{{ url }}">{{ item['text'] }}</a>
          </li>
        {% endfor %}
      </ul>

      <h3>Întrebări și interpelări</h3>

      <ul class="list-unstyled">
        {% for item in recent_questions %}
          {% set url = url_for(
              '.person_question',
              question_id=item['question_id'],
            ) %}
          <li>
            <strong>{{ item['date']|datefmt }}:</strong>

            <a href="{{ url }}">{{ item['text'] }}</a>
          </li>
        {% endfor %}
      </ul>

      <h3>Top domenii de politici publice</h3>

      <div class="policychart"></div>

      <ul>
        {%- for policy in policy_domains %}
          <li>
            {{ policy.name|link_for(
                '.policy_detail',
                policy_slug=policy.slug,
              ) }}
            ({{ policy.interest|percent }})
          </li>
        {%- endfor %}
      </ul>
    </div>
  </div>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static',
    filename='lib/d3-3.3.13/d3.v3.js') }}"></script>
<script src="{{ url_for('static', filename='policychart.js') }}"></script>
<script>
(function() {
  "use strict";

  $(document).ready(render);
  $(window).resize(render);

  function render() {
    app.render_policy_chart({
      container: $('.policychart').empty()[0],
      data: {{ policy_domains|tojson }},
      cutoff: 0.02
    });
  }

})();
</script>
{% endblock %}
