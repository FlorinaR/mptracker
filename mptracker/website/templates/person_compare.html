{% extends 'layout.html' %}


{% block title %}
  {{- super() }} – {{ name }} – comparație cu {{ other.name }}
{%- endblock %}


{% block content %}
  {%- from '_person_bits.html' import person_stats %}

  <div class="row">
    <div class="col-sm-6">
      <h2>{{ name|link_for('.person_detail', person_slug=person_slug) }}</h2>

      {{ person_stats(person_slug, stats) }}
    </div>

    <div class="col-sm-6">
      <h2>{{ other.name|link_for('.person_detail',
              person_slug=other.person_slug) }}</h2>

      {{ person_stats(other.person_slug, other.stats) }}
    </div>
  </div>

  <div id="similarity-barchart"></div>

  <div id="similarity-vote-venn"></div>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static',
    filename='lib/d3-3.3.13/d3.v3.js') }}"></script>
<script src="{{ url_for('static', filename='similaritychart.js') }}"></script>
<script>
(function() {
"use strict";

$(document).ready(render);
$(window).resize(render);


function render() {
    var barchart_container = $('#similarity-barchart').empty()[0];

    app.render_similarity_barchart({
        container: barchart_container,
        label: "prezență la vot",
        percent: true,
        data: {{ {
            "me": stats.vote['attendance'],
            "other": other.stats.vote['attendance'],
            }|tojson }}
    });

    app.render_similarity_barchart({
        container: barchart_container,
        label: "loialitate față de partid",
        percent: true,
        data: {{ {
            "me": stats.vote['loyalty'],
            "other": other.stats.vote['loyalty'],
            }|tojson }}
    });

    app.render_similarity_barchart({
        container: barchart_container,
        label: "loialitate față de guvern",
        percent: true,
        data: {{ {
            "me": stats.vote['cabinet_loyalty'],
            "other": other.stats.vote['cabinet_loyalty'],
            }|tojson }}
    });

    var max_scalar = {{ ([
            stats.speeches, other.stats.speeches,
            stats.questions, other.stats.questions,
            stats.proposals, other.stats.proposals,
            stats.local_score, other.stats.local_score,
        ]|sort)[-1]|tojson
    }};

    app.render_similarity_barchart({
        container: barchart_container,
        label: "luări de cuvânt",
        max: max_scalar,
        data: {{ {"me": stats.speeches, "other": other.stats.speeches}|tojson }}
    });

    app.render_similarity_barchart({
        container: barchart_container,
        label: "întrebări și interpelări",
        max: max_scalar,
        data: {{ {"me": stats.questions, "other": other.stats.questions}|tojson }}
    });

    app.render_similarity_barchart({
        container: barchart_container,
        label: "propuneri legislative",
        max: max_scalar,
        data: {{ {"me": stats.proposals, "other": other.stats.proposals}|tojson }}
    });

    app.render_similarity_barchart({
        container: barchart_container,
        label: "reprezentare locală",
        max: max_scalar,
        data: {{ {"me": stats.local_score, "other": other.stats.local_score}|tojson }}
    });

    app.render_similarity_vote_venn({
        container: $('#similarity-vote-venn').empty(),
        overlap: {{ similarity|tojson|safe }}
    });
}

})();
</script>
{% endblock %}
